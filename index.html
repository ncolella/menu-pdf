<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Menù</title>

  <style>
    :root { --bg:#0b0b0c; --fg:#f4f4f5; --muted:#a1a1aa; --card:#141416; }
    html, body { height:100%; margin:0; background:var(--bg); color:var(--fg); overflow:hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .wrap { height:100%; display:flex; flex-direction:column; }
    .top {
      height:56px; display:flex; align-items:center; justify-content:space-between;
      padding:0 14px; background:rgba(20,20,22,.92); backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .btn {
      appearance:none; border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06); color:var(--fg);
      padding:10px 12px; border-radius:12px; font-size:14px;
    }
    .btn:active { transform: translateY(1px); }
    .title { font-weight:600; font-size:14px; color:var(--muted); }
    .viewer { flex:1; display:flex; align-items:center; justify-content:center; padding:12px; }
    .card {
      width: min(980px, 100%);
      height: 100%;
      background: var(--card);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    canvas { width:100%; height:auto; display:block; }
    .hint { position: fixed; bottom: 12px; left: 0; right: 0; text-align:center; color:var(--muted); font-size:12px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <button class="btn" id="prev">←</button>
      <div class="title"><span id="pageInfo">Pagina 1</span></div>
      <div style="display:flex; gap:10px;">
        <button class="btn" id="fs">⛶</button>
        <button class="btn" id="next">→</button>
      </div>
    </div>

    <div class="viewer">
      <div class="card">
        <canvas id="c"></canvas>
      </div>
    </div>

    <div class="hint">Swipe ← → per sfogliare</div>
  </div>

  <!-- PDF.js (libreria) -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.7.76/build/pdf.min.js"></script>
  <script>
    // Config worker
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.7.76/build/pdf.worker.min.js";

    const url = "./menu.pdf";  // IMPORTANTISSIMO: il file deve chiamarsi menu.pdf
    const canvas = document.getElementById("c");
    const ctx = canvas.getContext("2d", { alpha: false });

    let pdfDoc = null;
    let pageNum = 1;
    let rendering = false;

    function setInfo() {
      document.getElementById("pageInfo").textContent = `Pagina ${pageNum} / ${pdfDoc.numPages}`;
    }

    async function renderPage(num) {
      rendering = true;
      const page = await pdfDoc.getPage(num);

      // scala: pagina a larghezza schermo (dentro la card)
      const card = document.querySelector(".card");
      const desiredWidth = card.clientWidth;
      const viewport1 = page.getViewport({ scale: 1 });
      const scale = desiredWidth / viewport1.width;
      const viewport = page.getViewport({ scale });

      canvas.width = Math.floor(viewport.width);
      canvas.height = Math.floor(viewport.height);

      await page.render({ canvasContext: ctx, viewport }).promise;
      rendering = false;
      setInfo();
    }

    function clampAndRender() {
      if (!pdfDoc || rendering) return;
      if (pageNum < 1) pageNum = 1;
      if (pageNum > pdfDoc.numPages) pageNum = pdfDoc.numPages;
      renderPage(pageNum);
    }

    document.getElementById("prev").onclick = () => { pageNum--; clampAndRender(); };
    document.getElementById("next").onclick = () => { pageNum++; clampAndRender(); };

    // Fullscreen
    document.getElementById("fs").onclick = async () => {
      const el = document.documentElement;
      if (!document.fullscreenElement) await el.requestFullscreen();
      else await document.exitFullscreen();
      setTimeout(clampAndRender, 250);
    };

    // Swipe sinistra/destra (niente scroll)
    let startX = null;
    document.addEventListener("touchstart", (e) => { startX = e.touches[0].clientX; }, { passive:true });
    document.addEventListener("touchend", (e) => {
      if (startX == null) return;
      const endX = e.changedTouches[0].clientX;
      const dx = endX - startX;
      startX = null;
      if (Math.abs(dx) < 40) return;
      if (dx < 0) pageNum++; else pageNum--;
      clampAndRender();
    }, { passive:true });

    // Resize: ricalcola scala
    window.addEventListener("resize", () => {
      if (!pdfDoc) return;
      clearTimeout(window.__r);
      window.__r = setTimeout(clampAndRender, 150);
    });

    // Carica PDF
    (async () => {
      try {
        pdfDoc = await pdfjsLib.getDocument(url).promise;
        await renderPage(pageNum);
      } catch (err) {
        document.querySelector(".hint").textContent =
          "Errore: PDF non trovato. Verifica che il file si chiami menu.pdf e sia nella root del repo.";
        console.error(err);
      }
    })();
  </script>
</body>
</html>
